---
interface Images {
  src: string;
  alt: string;
}

export interface Props {
  images: Images[];
}

const images = Astro.props.images as Images[];
---

<section class="carousel">
  <div class="flex w-full items-center justify-center">
    <div
      id="default-carousel"
      class="carousel-container relative"
      data-carousel="slide"
    >
      <!-- Carousel wrapper -->
      <div class="carousel-wrapper relative h-full overflow-hidden rounded-lg">
        <!-- Loop through images -->
        {
          images.map((image: any, index: number) => (
            <div
              class={`carousel-item rounded-lg ease-in-out ${
                index === 0 ? "" : "hidden"
              }`}
              data-carousel-item
            >
              <img
                src={image.src}
                class="carousel-image rounded-lg"
                alt={image.alt}
              />
            </div>
          ))
        }
      </div>

      <!-- Slider controls -->
      <button
        type="button"
        class="group absolute start-0 top-0 z-30 flex h-full cursor-pointer items-center justify-center border-none px-4 focus:outline-none"
        data-carousel-prev
      >
        <span
          class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/30 group-hover:bg-black/50 group-focus:outline-none group-focus:ring-4 group-focus:ring-black dark:bg-white/30 dark:group-hover:bg-white/60 dark:group-focus:ring-white/70"
        >
          <svg
            class="h-4 w-4 text-black dark:text-white rtl:rotate-180"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 6 10"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5 1 1 5l4 4"></path>
          </svg>
          <span class="sr-only">Previous</span>
        </span>
      </button>

      <button
        type="button"
        class="group absolute end-0 top-0 z-30 flex h-full cursor-pointer items-center justify-center border-none px-4 focus:outline-none"
        data-carousel-next
      >
        <span
          class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/30 group-hover:bg-black/50 group-focus:outline-none group-focus:ring-4 group-focus:ring-black dark:bg-white/30 dark:group-hover:bg-white/60 dark:group-focus:ring-white/70"
        >
          <svg
            class="h-4 w-4 text-black dark:text-white rtl:rotate-180"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 6 10"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 9 4-4-4-4"></path>
          </svg>
          <span class="sr-only">Next</span>
        </span>
      </button>
    </div>
  </div>
</section>

<style lang="scss">
  .carousel-container {
    height: 800px;
    width: 1200px;
    @media (max-width: 768px) {
      width: 100%;
      height: calc(100vh - 225px);
    }
  }

  .carousel-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-height: 100%;
    max-width: 100%;
    object-fit: contain;
    @media (max-width: 768px) {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .carousel-item {
    display: block;
  }
</style>

<script>
  // Mobile image carousel controls
  let startX = 0;
  let movedX = 0;

  const carousel = document.getElementById(
    "default-carousel"
  ) as HTMLDivElement;
  const prevButton = document.querySelector(
    "[data-carousel-prev]"
  ) as HTMLButtonElement;
  const nextButton = document.querySelector(
    "[data-carousel-next]"
  ) as HTMLButtonElement;

  if (carousel) {
    carousel.addEventListener(
      "touchstart",
      (event) => {
        startX = event.touches[0].clientX;
      },
      { passive: true }
    );

    carousel.addEventListener(
      "touchmove",
      (event) => {
        movedX = event.touches[0].clientX - startX;
      },
      { passive: true }
    );

    carousel.addEventListener(
      "touchend",
      () => {
        const threshold = 50;

        if (movedX > threshold && prevButton) {
          prevButton.click();
        } else if (movedX < -threshold && nextButton) {
          nextButton.click();
        }

        movedX = 0;
      },
      { passive: true }
    );
  }
</script>
